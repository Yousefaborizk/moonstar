{% extends 'base.html' %}

{% block content %}
<div class="card mb-4">
    <div class="row g-0">
        <div class="col-md-4">
            <!-- Main Image with ID for JS targeting -->
            <img src="{{ product.main_image.url }}" 
                 class="img-fluid rounded-start main-product-image" 
                 alt="{{ product.name }}"
                 id="mainProductImage">
            
            <div class="mt-3">
                <h5>Additional Images</h5>
                <div class="row" id="additionalImagesContainer">
                    {% for image in product.images.all %}
                    <div class="col-4 mb-3">
                        <img src="{{ image.image.url }}" 
                             class="img-thumbnail additional-image" 
                             alt="Product image"
                             data-image-url="{{ image.image.url }}"
                             style="cursor: pointer;">
                    </div>
                    {% empty %}
                    <div class="col-12">
                        <p class="text-muted">No additional images</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
        
        <!-- Rest of your product details remain unchanged -->
        <div class="col-md-8">
            <div class="card-body">
                <h1 class="card-title">{{ product.name }}</h1>

                {% if product.video %}
                <div class="mb-3">
                    <h4>Product Video</h4>
                    <video width="100%" autoplay muted controls>
                        <source src="{{ product.video.url }}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                </div>
                {% endif %}

                <p class="card-text"><strong>category:</strong> {{ product.category }}</p>
                <p class="card-text"><strong>Price:</strong> ${{ product.price }}</p>
                <p class="card-text"><strong>Total Quantity:</strong> {{ product.total_quantity }}</p>
                
                <div class="mb-3">
                    <h4>Details</h4>
                    <p class="card-text">{{ product.details|linebreaks }}</p>
                </div>
                

                
                <div class="d-flex gap-2">
                    <a href="{% url 'product_list' %}" class="btn btn-secondary">Back to Products</a>
                    <a href="{% url 'product_update' product.id %}" class="btn btn-warning px-4">
                        <i class="fas fa-edit mr-2"></i> Edit Product
                    </a>        
               </div>
            </div>
        </div>
    </div>
</div>

<div class="card">
    <div class="card-header">
        <h3>Inventory Across Warehouses</h3>
    </div>
    <div class="card-body">
        <table class="table">
            <thead>
                <tr>
                    <th>Warehouse</th>
                    <th>Address</th>
                    <th>Quantity</th>
                </tr>
            </thead>
            <tbody>
                {% for stock in warehouse_stock %}
                <tr>
                    <td><a href="{% url 'warehouse_detail' stock.warehouse.id %}">{{ stock.warehouse.name }}</a></td>
                    <td>{{ stock.warehouse.address|truncatechars:30 }}</td>
                    <td>{{ stock.quantity }}</td>
                </tr>
                {% empty %}
                <tr>
                    <td colspan="3" class="text-center">This product is not in any warehouse</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const mainImage = document.getElementById('mainProductImage');
    const additionalImages = document.querySelectorAll('.additional-image');
    
    // Store original main image URL
    const originalMainImage = mainImage.src;
    
    // Add click event to each additional image
    additionalImages.forEach(img => {
        img.addEventListener('click', function() {
            // Swap the images
            const clickedImageUrl = this.getAttribute('data-image-url');
            const currentMainImageUrl = mainImage.src;
            
            // Update main image
            mainImage.src = clickedImageUrl;
            
            // Update the clicked thumbnail to show the previous main image
            this.setAttribute('data-image-url', currentMainImageUrl);
            this.src = currentMainImageUrl;
            
            // Add visual feedback
            this.classList.add('border-primary', 'border-2');
            
            // Remove highlight from other images
            additionalImages.forEach(otherImg => {
                if (otherImg !== this) {
                    otherImg.classList.remove('border-primary', 'border-2');
                }
            });
        });
    });
    
    // Optional: Make main image clickable to reset to original
    mainImage.addEventListener('click', function() {
        if (mainImage.src !== originalMainImage) {
            // Find which thumbnail has the current main image
            additionalImages.forEach(img => {
                if (img.getAttribute('data-image-url') === mainImage.src) {
                    img.setAttribute('data-image-url', originalMainImage);
                    img.src = originalMainImage;
                    img.classList.remove('border-primary', 'border-2');
                }
            });
            
            // Reset main image
            mainImage.src = originalMainImage;
        }
    });
});
</script>

<style>
.main-product-image {
    cursor: pointer;
    transition: transform 0.3s ease;
    max-height: 400px;
    object-fit: contain;
}

.main-product-image:hover {
    transform: scale(1.02);
}

.additional-image {
    transition: all 0.3s ease;
}

.additional-image:hover {
    transform: scale(1.05);
    box-shadow: 0 0 10px rgba(0,0,0,0.1);
}

.border-primary {
    border-color: #0d6efd !important;
}
</style>
{% endblock %}